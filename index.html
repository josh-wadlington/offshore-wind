<!DOCTYPE html>
<html lang='en'>

<head>

  <title>Atlantic Offshore Wind</title>
  <meta charset='utf-8'>
  <meta name='viewport' content='width=device-width, initial-scale=1'>



  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.2.0/dist/leaflet.css" />
	<link href="https://fonts.googleapis.com/css?family=Noto+Sans" rel="stylesheet">
	<link href="https://fonts.googleapis.com/css?family=Lora" rel="stylesheet">

  <!-- reference to mapbox assembly library -->
  <link href="https://api.mapbox.com/mapbox-assembly/v0.19.0/assembly.min.css" rel="stylesheet">

  <!-- <link href='css/styles.css' rel='stylesheet' /> -->
  <style>

    /*rules for info panel*/
		.info {
			padding: 6px 8px;
			font-size: 1em;
			background: rgba(255, 255, 255, 0.8);
			box-shadow: 0 0 15px rgba(0, 0, 0, 0.2);
			border-radius: 5px;
			text-align: right;
		}
		.info h3 {
			margin: 0;
		}

    .grid {
      background-color: whitesmoke;
    }

    .legend-large, .legend-small {
        border-radius: 50%;
    }

    hr.small, hr.large {
        width: 83px;
        position: absolute;
        top: -8px;
        left: 55px;
        border: 1px solid #ccc;
        margin-top: 8px;
    }

  </style>

</head>

<body>

  <!-- info grid display on left of screen -->
  <div class='grid'>
    <div class='col col--12 col--3-ml p12 pb6 viewport-third viewport-full-ml'>
      <div class='h-full scroll-auto'>
        <h1 class='txt-h1 mb6'>Offshore Wind Capacity</h1>
        <p>Description of federal offshore wind program and layers on the map.</p>
        <h2 class='txt-xl mt18 mb12'>Capacity Estimate Description</h2>
        <p>Formula for calculating capacity estimates. Megawatts produced and houses powered.</p>
        <footer class='mt12 bg-gray-faint txt-s'>
          <ul>
            <li>Explore the <a class='link' href='#'>data</a></li>
            <li>Map authored by <a class='link' href='#'>Caretta caretta</a></li>
            </p>
        </footer>
      </div>
    </div>

    <!-- map display -->
    <div class='col col--12 col--9-ml h180 h-full-ml'>
      <div id="map" class='viewport-twothirds viewport-full-ml'></div>

    <!-- legend -->
     <div id='legend' class='bg-white round-ml opacity75 p18'>
       <h3 class='txt-bold color-black mb12 w-full mx-auto'>Array Capacity <br>in MW </br></h3>
       <div class='legend-circles relative w180 wmax180'>
         <div class="legend-large border border--white absolute"></div>
         <div class="legend-small border border--white absolute"></div>
         <div class="legend-large-label color-white txt-m absolute"></div>
         <div class="legend-small-label color-white txt-m absolute"></div>
       </div>
     </div>

    <!-- load jquery and leaflet libraries -->
    <script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
    <script src="https://unpkg.com/leaflet@1.2.0/dist/leaflet.js"></script>

    <!-- load assembly, mapbox and omnivore libraries -->
    <script async defer src="https://api.mapbox.com/mapbox-assembly/v0.19.0/assembly.js"></script>
    <script src='https://api.tiles.mapbox.com/mapbox.js/plugins/leaflet-omnivore/v0.3.1/leaflet-omnivore.min.js'></script>

    <!-- reference to js as relative path -->
    <!-- <script src='js/app.js'></script> -->

    <script src="data/Centroids_Acres_MW.js"></script>

    <script>

      //initialize map
      var map = L.map('map', {
                 center: [37.1, -72.1],
                 zoom: 6.2,
                 minZoom: 4
             });

      // load basemaps
      var basemaps = {
           //bathy - shows continental shelf break
           Bathymetry: L.tileLayer.wms('https://www.gebco.net/data_and_products/gebco_web_services/web_map_service/mapserv?', {
              layers: 'GEBCO_LATEST'
           }),
           //osm - shows maritime boundaries
           'Marine Boundaries': L.tileLayer('http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
           }),
           //NOAA charts
           'Nautical Charts': L.tileLayer('//tileservice.charts.noaa.gov/tiles/50000_1/{z}/{x}/{y}.png', {
           }),
       };
       
        // add CARTO voyager tiles to display under NOAA Nautical Charts
        L.tileLayer('https://cartodb-basemaps-{s}.global.ssl.fastly.net/rastertiles/voyager/{z}/{x}/{y}.png', {
            maxZoom: 18, attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>, &copy;<a href="https://carto.com/attribution">CARTO</a>'
        }).addTo(map);

       //add control to switch basemaps
       L.control.layers(basemaps).addTo(map);
       //add bathymetry as default basemap
       basemaps.Bathymetry.addTo(map);

       //add scale control:
       L.control.scale().addTo(map);

      // AJAX call to load planning area outline polygons
      $.getJSON("data/BOEM_Wind_Planning_Areas_Outline.geojson", function(data) {
        // draw the map using GeoJSON data
        drawMap(data);
        // console.log(data);
      });

      // AJAX call to load lease outline polygons
      $.getJSON("data/BOEM_Lease_Areas_Outline.geojson", function(data) {
        // draw the map using GeoJSON data
        drawMap(data);
        // console.log(data);
      });

      // AJAX call to load lease polygons
      var leasePolys = $.getJSON("data/BOEM_Lease_Areas.geojson", function(data) {
        // draw the map using GeoJSON data
        drawMap(data);
        console.log(data);
      });

      // AJAX call to load planning area polygons
      $.getJSON("data/BOEM_Wind_Planning_Areas.geojson", function(data) {
        // draw the map using GeoJSON data
        drawMap(data);
        // console.log(data);
      });

      //add capacity estimates
      L.geoJson(acresMW, {
          pointToLayer: function(feature,latlng) {
              return L.circleMarker(latlng, {
                  color: '#a64dff',
                  fillColor: '#bf80ff',
                  weight: 1,
                  stroke: 1,
                  fillOpacity: .5,
                  radius: getRadius(feature.properties.MW)
              });
          },
      }).addTo(map);

      //function to get prop symbol size
      function getRadius(val) {
          var radius = Math.sqrt(val/Math.PI);
          return radius * 1.8;
      }

      // // load CSV data
      // omnivore.csv('data/BOEM_Centroids_Acres.csv')
      //   .on('ready', function(e) {
      //     drawMap(e.target.toGeoJSON());
      //     // drawLegend(e.target.toGeoJSON());
      //     console.log(e);
      //   })
      //   //throw error if data does not load
      //   .on('error', function(e) {
      //     console.log(e.error[0].message);
      //   });

      // create control for legend
      var legend = L.control({position: 'bottomright'});

      legend.onAdd = function(map) {

            var div = L.DomUtil.get("legend");
            //disable unwanted map dragging
            L.DomEvent.disableScrollPropagation(div);
            L.DomEvent.disableClickPropagation(div);

            return div;

          };

      legend.addTo(map);

      //begin function to define map drawing paramaters
      function drawMap(data) {
        // create Leaflet data layer and add to map
        var dataLayer = L.geoJson(data, {
          style: function(feature) {
            // style lease areas with initial default path options
            return {
              color: 'black',
              weight: .5,
              fillOpacity: .5
            };
          }
        }).addTo(map);

        //statement to draw info panel
        drawInfo();

        //get info panel data from updateInfo function
  			dataLayer.eachLayer(function(layer) {
  				layer.on('mouseover', function() {
  					updateInfo(this);
  				});
  			});

        //highlight feature on mouseover
        dataLayer.eachLayer(function(layer) {
          layer.on('mouseover', function() {
            layer.setStyle({
              color: 'yellow',
              opacity: 1,
              weight: 2
            }).bringToFront();
          });
        });
        //return feature to default style after mouseout
        dataLayer.eachLayer(function(layer) {
          layer.on('mouseout', function() {
            layer.setStyle({
              color: 'black',
              weight: .5,
            });
          });
        });

        //draw info panel only when user hovers over county
  			dataLayer.on('mouseover', function() {
  				$(".info").show();
  			});
  			dataLayer.on('mouseout', function() {
  				$(".info").hide();
  			});

        dataLayer.eachLayer(function(layer) {
    			// shortcut reference for layer properties
    			var props = layer.feature.properties;

    			// assemble string sequence of info for tooltip
    			var tooltipInfo = "<b>" + "Block #: " + props["BLOCK_NUMB"]
    			// bind a tooltip to layer
    			layer.bindTooltip(tooltipInfo, {
    				sticky: true
    			});
    		});

      }

      //begin function to draw info panel
  		function drawInfo() {
  			//variable to indicate position of panel
  			var info = L.control({
  				position: 'topright'
  			});
  			info.onAdd = function(map) {
  				var div = L.DomUtil.create('div', 'info');
  				return div;
  			}
  			//add info to map
  			info.addTo(map);
  			//hide when no mouseover
  			$(".info").hide();
  		}

      //begin function to define info layer panel attributes and values
  		function updateInfo(layer) {
  			//variable to get feature values
  			var props = layer.feature.properties;

  			//descriptions of values to be displayed in panel on map
  			var html = "<h3>Lease #: " + props['Lease_Numb'] + "</h3>" +
                   "Lessee: <b>" + props["Company"] + "</b><br>"
  			//add values to map
  			$(".info").html(html);

  		}

      // !!NEEDS WORK - function to draw proportional symbols in legend
      // function drawLegend(data) {
      //
      //     // create Leaflet control for the legend
      //     var legend = L.control({
      //       position: 'bottomright'
      //     });
      //
      //     legend.onAdd = function(map) {
      //
      //       var div = L.DomUtil.get("legend");
      //       //disable unwanted map dragging
      //       L.DomEvent.disableScrollPropagation(div);
      //       L.DomEvent.disableClickPropagation(div);
      //
      //       return div;
      //
      //     }
      //
      //     legend.addTo(map);
      //
      //     var dataValues = [];
      //
      //     data.features.map(function(megaWatts) {
      //       //loop through data values
      //       for (var MW in feature.properties) {
      //
      //         var attribute = feature.properties[MW];
      //         //check if number
      //         if (Number(attribute)) {
      //
      //           dataValues.push(attribute);
      //         }
      //
      //       }
      //     });
      //
      //     // sort our array
      //     var sortedValues = dataValues.sort(function(a, b) {
      //       return b - a;
      //     });
      //
      //     // round the highest number and use as our large circle diameter
      //     var maxValue = Math.round(sortedValues[0] / 1000) * 1000;
      //
      //     // calc the diameters
      //     var largeDiameter = calcRadius(maxValue) * 2,
      //       smallDiameter = largeDiameter / 2;
      //
      //     // select our circles container and set the height
      //     $(".legend-circles").css('height', largeDiameter.toFixed());
      //
      //     // set width and height for large circle
      //     $('.legend-large').css({
      //       'width': largeDiameter.toFixed(),
      //       'height': largeDiameter.toFixed()
      //     });
      //     // set width and height for small circle and position
      //     $('.legend-small').css({
      //       'width': smallDiameter.toFixed(),
      //       'height': smallDiameter.toFixed(),
      //       'top': largeDiameter - smallDiameter,
      //       'left': smallDiameter / 2
      //     })
      //
      //     // label the max and median value
      //     $(".legend-large-label").html(maxValue);
      //     $(".legend-small-label").html((maxValue / 2));
      //
      //     // adjust the position of the large based on size of circle
      //     $(".legend-large-label").css({
      //       'top': -11,
      //       'left': largeDiameter + 30,
      //     });
      //
      //     // adjust the position of the large based on size of circle
      //     $(".legend-small-label").css({
      //       'top': smallDiameter - 11,
      //       'left': largeDiameter + 30
      //     });
      //
      //     // insert a couple hr elements and use to connect value label to top of each circle
      //     $("<hr class='large'>").insertBefore(".legend-large-label")
      //     $("<hr class='small'>").insertBefore(".legend-small-label").css('top', largeDiameter - smallDiameter - 8);
      //
      //   }

    </script>

</body>

</html>
